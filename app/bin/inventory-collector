#!/usr/bin/env ruby
require_relative '../config/defaults'
STDOUT.sync = true

$logger.info 'Initializing Kubernetes Inventory Collector'

# Load configuration values
config = Inventory::load_configuration($logger)

begin
  while true
    InventoryCollector.new(config).collect
    File.write("/tmp/heartbeat", "")  # for kubernetes health check
    sleep INVENTORY_SCHEDULER_PERIOD
  end
rescue => e
  $logger.error e
  raise e
end
